<!-- Professional Trading Terminal Navigation Bar -->
<div class="navbar-container">
    <!-- Left Section: Logo and Main Nav -->
    <div class="flex items-center h-full">
        <!-- Mobile Menu Button (Preserved for mobile) -->
        <label for="main-drawer" class="btn btn-ghost btn-sm lg:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16" />
            </svg>
        </label>

        <!-- Logo/Brand -->
        <a href="/" class="navbar-brand">
            <img src="{{ url_for('static', filename='favicon/logo.png') }}" alt="OpenAlgo">
            <span class="hidden sm:inline">OpenAlgo</span>
        </a>

        <!-- Main Navigation (Desktop) -->
        <nav class="navbar-nav hidden lg:flex">
            <a href="{{ url_for('dashboard_bp.dashboard') }}"
               class="nav-item {{ 'active' if request.endpoint == 'dashboard_bp.dashboard' }}">
                Dashboard
            </a>
            <a href="{{ url_for('orders_bp.orderbook') }}"
               class="nav-item {{ 'active' if request.endpoint == 'orders_bp.orderbook' }}">
                Orders
            </a>
            <a href="{{ url_for('orders_bp.tradebook') }}"
               class="nav-item {{ 'active' if request.endpoint == 'orders_bp.tradebook' }}">
                Trades
            </a>
            <a href="{{ url_for('orders_bp.positions') }}"
               class="nav-item {{ 'active' if request.endpoint == 'orders_bp.positions' }}">
                Positions
            </a>
            <a href="{{ url_for('tv_json_bp.tradingview_json') }}"
               class="nav-item {{ 'active' if request.endpoint == 'tv_json_bp.tradingview_json' }}">
                Charts
            </a>
            <a href="{{ url_for('strategy_bp.index') }}"
               class="nav-item {{ 'active' if request.endpoint.startswith('strategy_bp.') }}">
                Strategy
            </a>
            <a href="{{ url_for('analyzer_bp.analyzer') }}"
               class="nav-item {{ 'active' if request.endpoint == 'analyzer_bp.analyzer' }}">
                Analyzer
            </a>
        </nav>
    </div>

    <!-- Center Section: Market Ticker (Desktop) -->
    <div class="market-ticker hidden xl:flex">
        <div class="ticker-item">
            <span class="ticker-label">NIFTY</span>
            <span class="ticker-value" id="nifty-value">--</span>
            <span class="ticker-change" id="nifty-change">--</span>
        </div>
        <div class="ticker-item">
            <span class="ticker-label">SENSEX</span>
            <span class="ticker-value" id="sensex-value">--</span>
            <span class="ticker-change" id="sensex-change">--</span>
        </div>
        <div class="ticker-item">
            <span class="ticker-label">BANKNIFTY</span>
            <span class="ticker-value" id="banknifty-value">--</span>
            <span class="ticker-change" id="banknifty-change">--</span>
        </div>
    </div>

    <!-- Right Section: Actions & User -->
    <div class="flex items-center gap-2 h-full">
        <!-- Mode Badge and Toggle (Preserved functionality) -->
        <div class="flex items-center gap-2">
            <!-- Mode Badge -->
            <span id="mode-badge" class="mode-badge live">
                LIVE
            </span>

            <!-- Mode Toggle -->
            <div class="tooltip tooltip-bottom" data-tip="Toggle Live/Analyze Mode">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" class="sr-only mode-controller">
                    <div class="w-11 h-6 bg-base-300 rounded-full peer peer-checked:bg-warning transition-colors">
                        <div class="absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition-transform peer-checked:translate-x-5"></div>
                    </div>
                </label>
            </div>
        </div>

        <!-- Theme Toggle (Simplified) -->
        <button class="btn btn-ghost btn-sm btn-circle theme-switcher" onclick="toggleTheme()">
            <svg class="w-5 h-5 theme-icon-light" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <svg class="w-5 h-5 theme-icon-dark hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
        </button>

        <!-- Notifications -->
        <button class="btn btn-ghost btn-sm btn-circle relative">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
            <span class="absolute top-1 right-1 w-2 h-2 bg-error rounded-full animate-pulse"></span>
        </button>

        <!-- User Profile Dropdown (Simplified) -->
        <div class="dropdown dropdown-end">
            <label tabindex="0" class="btn btn-ghost btn-sm btn-circle">
                <div class="avatar placeholder">
                    <div class="bg-primary text-primary-content rounded-full w-8">
                        <span class="text-sm font-semibold">{{ session['user'][0]|upper if session.user else 'U' }}</span>
                    </div>
                </div>
            </label>
            <ul tabindex="0" class="menu menu-sm dropdown-content mt-2 z-50 p-2 shadow-lg bg-base-100 rounded-lg w-52 border border-base-300">
                <!-- Quick Stats -->
                <li class="menu-title">
                    <span class="text-xs uppercase font-semibold">Account</span>
                </li>
                <li>
                    <a href="{{ url_for('auth.change_password') }}" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        Profile Settings
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('api_key_bp.manage_api_key') }}" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                        </svg>
                        API Keys
                    </a>
                </li>

                <!-- Quick Links -->
                <li class="menu-title">
                    <span class="text-xs uppercase font-semibold">Quick Links</span>
                </li>
                <li>
                    <a href="{{ url_for('orders_bp.holdings') }}" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                        </svg>
                        Holdings
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('python_strategy_bp.index') }}" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                        </svg>
                        Python Strategies
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('pnltracker_bp.pnltracker') }}" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        P&L Tracker
                    </a>
                </li>

                <!-- Tools & Monitor -->
                <li class="menu-title">
                    <span class="text-xs uppercase font-semibold">Tools</span>
                </li>
                <li>
                    <a href="{{ url_for('telegram_bp.index') }}" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                        </svg>
                        Telegram Bot
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('log_bp.view_logs') }}" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        System Logs
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('traffic_bp.traffic_dashboard') }}" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        Traffic Monitor
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('latency_bp.latency_dashboard') }}" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Latency Monitor
                    </a>
                </li>

                <!-- Search & Resources -->
                <li class="menu-title">
                    <span class="text-xs uppercase font-semibold">Resources</span>
                </li>
                <li>
                    <a href="{{ url_for('search_bp.token') }}" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        Symbol Search
                    </a>
                </li>
                <li>
                    <a href="https://docs.openalgo.in" target="_blank" class="py-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                        Documentation
                        <svg class="w-3 h-3 ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                    </a>
                </li>

                <!-- Logout -->
                <div class="divider my-2"></div>
                <li>
                    <form method="POST" action="{{ url_for('auth.logout') }}" class="m-0">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="w-full text-left py-2 text-error hover:bg-error/10">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                            Logout
                        </button>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- Enhanced Theme Toggle Script -->
<script>
function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const themes = ['professional', 'professional_dark', 'analytics'];
    const currentIndex = themes.indexOf(currentTheme);
    const nextIndex = (currentIndex + 1) % themes.length;
    const nextTheme = themes[nextIndex];

    document.documentElement.setAttribute('data-theme', nextTheme);
    localStorage.setItem('theme', nextTheme);

    // Update theme icons
    const lightIcon = document.querySelector('.theme-icon-light');
    const darkIcon = document.querySelector('.theme-icon-dark');

    if (nextTheme.includes('dark')) {
        lightIcon?.classList.add('hidden');
        darkIcon?.classList.remove('hidden');
    } else {
        lightIcon?.classList.remove('hidden');
        darkIcon?.classList.add('hidden');
    }
}

// Initialize theme icon on load
document.addEventListener('DOMContentLoaded', function() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const lightIcon = document.querySelector('.theme-icon-light');
    const darkIcon = document.querySelector('.theme-icon-dark');

    if (currentTheme && currentTheme.includes('dark')) {
        lightIcon?.classList.add('hidden');
        darkIcon?.classList.remove('hidden');
    }

    // Simulate market ticker updates (replace with real WebSocket data)
    function updateMarketTicker() {
        // This is dummy data - replace with actual market data feed
        const tickers = {
            'nifty': { value: '19,425.35', change: '+0.58%', positive: true },
            'sensex': { value: '65,259.45', change: '+0.42%', positive: true },
            'banknifty': { value: '44,532.20', change: '-0.23%', positive: false }
        };

        Object.keys(tickers).forEach(key => {
            const valueEl = document.getElementById(`${key}-value`);
            const changeEl = document.getElementById(`${key}-change`);

            if (valueEl) valueEl.textContent = tickers[key].value;
            if (changeEl) {
                changeEl.textContent = tickers[key].change;
                changeEl.className = `ticker-change ${tickers[key].positive ? 'positive' : 'negative'}`;
            }
        });
    }

    // Update ticker on load
    updateMarketTicker();

    // Update ticker every 5 seconds (replace with WebSocket)
    setInterval(updateMarketTicker, 5000);
});
</script>